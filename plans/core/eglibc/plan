name="eglibc"
version="2.13"
source="nil"
verify="no_verify"
build_args="--disable-profile --enable-add-ons \
--with-tls --enable-kernel=2.6.0 --with-__thread \
--with-headers=$PREFIX/include"

custom_stage() {
	_pushd $sources
		[[ ! -d $build_name ]] && svn co http://www.eglibc.org/svn/branches/eglibc-2_13 eglibc-$version
	_popd

	[[ ! -d $stages/$build_name ]] && svn export $sources/$build_name $stages/$build_name
	[[ ! -d $builds/$build_name ]] && mkdir $builds/$build_name
	return 0
}

cross_build() {
	_pushd $stages/$build_name/libc
		cp -v Makeconfig{,.orig}
		sed -e 's/-lgcc_eh//g' Makeconfig.orig > Makeconfig
		ln -sf ../ports
	_popd
	_pushd $builds/$build_name
cat > config.cache << "EOF"
libc_cv_forced_unwind=yes
libc_cv_c_cleanup=yes
libc_cv_gnu89_inline=yes
libc_cv_ssp=no
EOF
	_popd
}

custom_build() {
	echo "OPTION_EGLIBC_LOCALES = n" > option-groups.config
	#echo "OPTION_EGLIBC_NIS = n" >> option-groups.config
	#echo "OPTION_EGLIBC_SUNRPC = n" >> option-groups.config
	$stages/$build_name/libc/configure $CONFIG
	make
}

custom_install() {
	make -j1 install_root=$DESTDIR install
}
